#!/bin/bash

set -e

export PATH="$PWD/bin/dev-tools:$PWD/node_modules/.bin:$PATH"

args="$@"

function run_in_package() {
  pushd "$1" > /dev/null
  echo "$1"
  echo "$args"
  $args
  popd > /dev/null
}

if [[ "$1" == '-p' ]]; then
  packagePath="$2"
  shift 2
  args="$@"
  run_in_package $packagePath
else
  for package in `ls packages`;do
    if [[ "$package" == 'node_modules' ]]; then
      continue
    fi
    run_in_package "packages/$package"
  done
fi
